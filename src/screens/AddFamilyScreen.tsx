import React, { useState } from 'react';
import { View, Text, TextInput, Button, Alert, ScrollView, Image, Platform, StyleSheet, TouchableOpacity } from 'react-native'; // Added TouchableOpacity
import * as ImagePicker from 'expo-image-picker';
import * as FileSystem from 'expo-file-system';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { API_BASE_URL } from '../utils/api';

interface AddFamilyScreenProps {
  navigation: any;
}

export default function AddFamilyScreen({ navigation }: AddFamilyScreenProps) {
  const [formData, setFormData] = useState({
    childName: '',
    gender: '‡§≤‡§°‡§º‡§ï‡§æ' as '‡§≤‡§°‡§º‡§ï‡§æ' | '‡§≤‡§°‡§º‡§ï‡•Ä',
    dateOfBirth: '',
    age: '',
    weight: '',
    height: '',
    anganwadiCenterName: '‡§∏‡§∞‡§∏‡•ç‡§µ‡§§‡•Ä ‡§Ü‡§Ç‡§ó‡§®‡§¨‡§æ‡§°‡§º‡•Ä ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞',
    anganwadiCode: 'AWC-123-DLH', // Keep this as string for parsing
    motherName: '',
    fatherName: '',
    mobileNumber: '', // This will be the username
    village: '',
    ward: '',
    panchayat: '',
    district: '',
    distributionDate: '', // Not used in backend register
    workerName: '', // Mapped to guardian_name
    workerCode: 'AWW-123', // Not used in backend register
    block: '',
    registrationDate: new Date().toLocaleDateString('hi-IN'), // Not used in backend register
  });

  const [photos, setPhotos] = useState({
    plantPhoto: null as string | null, // This will now store the URI, not base64
    pledgePhoto: null as string | null, // This will now store the URI, not base64
  });
  const [loading, setLoading] = useState(false);
  const [showConfirmDialog, setShowConfirmDialog] = useState(false);

  // Add validation function
  const isFormValid = () => {
    return (
      formData.childName.trim() !== '' &&
      formData.dateOfBirth.trim() !== '' &&
      formData.age.trim() !== '' &&
      formData.weight.trim() !== '' &&
      formData.height.trim() !== '' &&
      formData.motherName.trim() !== '' &&
      formData.fatherName.trim() !== '' &&
      formData.mobileNumber.trim() !== '' &&
      formData.anganwadiCode.trim() !== '' &&
      formData.village.trim() !== '' &&
      formData.district.trim() !== '' &&
      formData.block.trim() !== '' &&
      photos.plantPhoto !== null &&
      photos.pledgePhoto !== null
    );
  };

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  // MODIFIED pickImage & pickFromGallery to store URI, not base64
  const pickImage = async (photoType: 'plantPhoto' | 'pledgePhoto') => {
    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();
    if (!permissionResult.granted) {
      Alert.alert('‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï', '‡§ï‡•à‡§Æ‡§∞‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç');
      return;
    }
    const result = await ImagePicker.launchCameraAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: false, // Remove crop functionality
      quality: 1,
      // base64: true, // NO LONGER NEED BASE64 HERE
    });
    if (!result.canceled) {
      setPhotos(prev => ({ ...prev, [photoType]: result.assets[0].uri })); // Store URI
    }
  };

  const pickFromGallery = async (photoType: 'plantPhoto' | 'pledgePhoto') => {
    const permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();
    if (!permissionResult.granted) {
      Alert.alert('‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï', '‡§ó‡•à‡§≤‡§∞‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç');
      return;
    }
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: false, // Remove crop functionality
      quality: 1,
      // base64: true, // NO LONGER NEED BASE64 HERE
    });
    if (!result.canceled) {
      setPhotos(prev => ({ ...prev, [photoType]: result.assets[0].uri })); // Store URI
    }
  };

  const showImageOptions = (photoType: 'plantPhoto' | 'pledgePhoto', title: string) => {
    Alert.alert(
      '‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç',
      '‡§´‡•ã‡§ü‡•ã ‡§ï‡•à‡§∏‡•á ‡§≤‡•á‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?',
      [
        {
          text: 'üì∑ ‡§ï‡•à‡§Æ‡§∞‡§æ',
          onPress: () => pickImage(photoType),
        },
        {
          text: 'üñºÔ∏è ‡§ó‡•à‡§≤‡§∞‡•Ä',
          onPress: () => pickFromGallery(photoType),
        },
        {
          text: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
          style: 'cancel',
        },
      ]
    );
  };

  const formatDateToYYYYMMDD = (dateString: string) => {
    const [day, month, year] = dateString.split('/');
    return `${year}-${month}-${day}`;
  };

  const confirmRegistration = async () => {
    setShowConfirmDialog(false);
    setLoading(true);
    try {
      const data = new FormData(); // Create FormData object

      // Append text fields
      data.append('username', formData.mobileNumber?.toUpperCase() || '');
      data.append('name', formData.childName);
      data.append('password', 'hgm@2025'); // Still using hardcoded password - remember my warnings!
      data.append('guardian_name', formData.workerName);
      data.append('father_name', formData.fatherName);
      data.append('mother_name', formData.motherName);
      data.append('age', formData.age); // Send as string, backend will parse int
      data.append('dob', formatDateToYYYYMMDD(formData.dateOfBirth));
      data.append('aanganwadi_code', String(parseInt(formData.anganwadiCode?.match(/\d+/)?.[0] || '0'))); // Parse and send as string
      data.append('weight', formData.weight); // Send as string, backend will parse float
      data.append('height', formData.height); // Send as string, backend will parse float
      data.append('health_status', 'healthy');

      // Address parts - append separately or as concatenated string
      // If you want backend to combine, append individually.
      // If backend expects combined 'address' field, combine here.
      // Backend expects 'address' as one field, so combine on frontend.
      const address = `${formData.village}, ${formData.ward}, ${formData.panchayat}, ${formData.district}, ${formData.block}`;
      data.append('address', address);
      data.append('village', formData.village); // Include these too if backend needs them separately later
      data.append('ward', formData.ward);
      data.append('panchayat', formData.panchayat);
      data.append('district', formData.district);
      data.append('block', formData.block);

      // Append image files
      if (photos.plantPhoto) {
        data.append('plant_photo', {
          uri: photos.plantPhoto,
          name: 'plant_photo.jpg', // You might want a more dynamic name or rely on backend to generate
          type: 'image/jpeg', // Adjust type if you allow other formats
        } as any); // Use 'as any' for now, or define a proper type for Blob/File
      }

      if (photos.pledgePhoto) {
        data.append('pledge_photo', {
          uri: photos.pledgePhoto,
          name: 'pledge_photo.jpg',
          type: 'image/jpeg',
        } as any);
      }

      console.log('Sending FormData:', data); // Console log FormData is tricky, will show as [object FormData]

      const response = await fetch(`${API_BASE_URL}/register`, {
        method: 'POST',
        // No 'Content-Type' header needed here, fetch sets it automatically for FormData
        body: data, // Send the FormData object directly
      });

      console.log('Response status:', response.status);
      const result = await response.json();
      console.log('Response data:', result);

      if (response.ok && result.success) {
        Alert.alert('‡§∏‡§´‡§≤‡§§‡§æ!', '‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡§æ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§', [
                      { 
              text: '‡§†‡•Ä‡§ï ‡§π‡•à', 
              onPress: () => {
                // Clear the saved family IDs to force refresh of notifications
                AsyncStorage.removeItem('saved_family_ids');
                navigation.goBack();
              }
            },
        ]);
      } else {
        Alert.alert('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', result.message || '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§Ö‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ');
      }
    } catch (err) {
      console.error('Registration error:', err);
      // Show a gentler message for network errors
      console.log('‚ö†Ô∏è Network error during registration, data may be saved locally');
      Alert.alert('‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ', '‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§Ø‡§π ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§');
    } finally {
      setLoading(false);
    }
  };

  return (
    <ScrollView style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.headerText}>‡§®‡§Ø‡§æ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</Text>
      </View>

      {/* ‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä */}
      <View style={styles.section}>
        <Text style={styles.sectionTitle}>‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</Text>
        
        <Text style={styles.label}>‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ</Text>
        <TextInput 
          value={formData.childName} 
          onChangeText={(v) => handleInputChange('childName', v)} 
          style={styles.input}
          placeholder="‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (dd/mm/yyyy)</Text>
        <TextInput 
          value={formData.dateOfBirth} 
          onChangeText={(v) => handleInputChange('dateOfBirth', v)} 
          style={styles.input}
          placeholder="‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§Ü‡§Ø‡•Å</Text>
        <TextInput 
          value={formData.age} 
          onChangeText={(v) => handleInputChange('age', v)} 
          keyboardType="numeric" 
          style={styles.input}
          placeholder="‡§Ü‡§Ø‡•Å ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§µ‡§ú‡§® (kg)</Text>
        <TextInput 
          value={formData.weight} 
          onChangeText={(v) => handleInputChange('weight', v)} 
          keyboardType="numeric" 
          style={styles.input}
          placeholder="‡§µ‡§ú‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§ä‡§Ç‡§ö‡§æ‡§à (cm)</Text>
        <TextInput 
          value={formData.height} 
          onChangeText={(v) => handleInputChange('height', v)} 
          keyboardType="numeric" 
          style={styles.input}
          placeholder="‡§ä‡§Ç‡§ö‡§æ‡§à ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />
      </View>

      {/* ‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä */}
      <View style={styles.section}>
        <Text style={styles.sectionTitle}>‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</Text>
        
        <Text style={styles.label}>‡§Æ‡§æ‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</Text>
        <TextInput 
          value={formData.motherName} 
          onChangeText={(v) => handleInputChange('motherName', v)} 
          style={styles.input}
          placeholder="‡§Æ‡§æ‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</Text>
        <TextInput 
          value={formData.fatherName} 
          onChangeText={(v) => handleInputChange('fatherName', v)} 
          style={styles.input}
          placeholder="‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ (ID)</Text>
        <TextInput 
          value={formData.mobileNumber} 
          onChangeText={(v) => handleInputChange('mobileNumber', v)} 
          style={styles.input}
          placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
          keyboardType="phone-pad"
        />

        <Text style={styles.label}>‡§Ü‡§Ç‡§ó‡§®‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•ã‡§°</Text>
        <TextInput 
          value={formData.anganwadiCode} 
          onChangeText={(v) => handleInputChange('anganwadiCode', v)} 
          style={styles.input}
          placeholder="‡§Ü‡§Ç‡§ó‡§®‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•ã‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />
      </View>

      {/* ‡§™‡§§‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä */}
      <View style={styles.section}>
        <Text style={styles.sectionTitle}>‡§™‡§§‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</Text>
        
        <Text style={styles.label}>‡§ó‡§æ‡§Å‡§µ</Text>
        <TextInput 
          value={formData.village} 
          onChangeText={(v) => handleInputChange('village', v)} 
          style={styles.input}
          placeholder="‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§µ‡§æ‡§∞‡•ç‡§°</Text>
        <TextInput 
          value={formData.ward} 
          onChangeText={(v) => handleInputChange('ward', v)} 
          style={styles.input}
          placeholder="‡§µ‡§æ‡§∞‡•ç‡§° ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§</Text>
        <TextInput 
          value={formData.panchayat} 
          onChangeText={(v) => handleInputChange('panchayat', v)} 
          style={styles.input}
          placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§ú‡§ø‡§≤‡§æ</Text>
        <TextInput 
          value={formData.district} 
          onChangeText={(v) => handleInputChange('district', v)} 
          style={styles.input}
          placeholder="‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />

        <Text style={styles.label}>‡§µ‡§ø‡§ï‡§æ‡§∏‡§ñ‡§Ç‡§° (Block)</Text>
        <TextInput 
          value={formData.block} 
          onChangeText={(v) => handleInputChange('block', v)} 
          style={styles.input}
          placeholder="‡§µ‡§ø‡§ï‡§æ‡§∏‡§ñ‡§Ç‡§° ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
        />
      </View>

      {/* Photo Upload Section */}
      <View style={styles.section}>
        <Text style={styles.sectionTitle}>‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§°</Text>
        
        <Text style={styles.label}>‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã</Text>
        <View style={styles.uploadBlock}>
          {photos.plantPhoto ? (
            <View style={styles.photoContainer}>
              <Image source={{ uri: photos.plantPhoto }} style={styles.photoPreview} />
              <TouchableOpacity style={styles.cameraButton} onPress={() => showImageOptions('plantPhoto', '‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡•ã ‡§Æ‡•Å‡§Ç‡§ó‡•á ‡§ï‡§æ ‡§™‡•á‡§°‡§º ‡§¶‡•á‡§§‡•á ‡§π‡•Å‡§è ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç')}>
                <Text style={styles.cameraButtonText}>üì∑ ‡§®‡§à ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</Text>
              </TouchableOpacity>
            </View>
          ) : (
            <View style={styles.photoContainer}>
              <View style={styles.photoPlaceholder}>
                <Text style={styles.photoPlaceholderText}>‡§ï‡•ã‡§à ‡§´‡•ã‡§ü‡•ã ‡§®‡§π‡•Ä‡§Ç</Text>
              </View>
              <TouchableOpacity style={styles.cameraButton} onPress={() => showImageOptions('plantPhoto', '‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡•ã ‡§Æ‡•Å‡§Ç‡§ó‡•á ‡§ï‡§æ ‡§™‡•á‡§°‡§º ‡§¶‡•á‡§§‡•á ‡§π‡•Å‡§è ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç')}>
                <Text style={styles.cameraButtonText}>üì∑ ‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</Text>
              </TouchableOpacity>
            </View>
          )}
        </View>

        <Text style={styles.label}>‡§∂‡§™‡§• ‡§™‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã</Text>
        <View style={styles.uploadBlock}>
          {photos.pledgePhoto ? (
            <View style={styles.photoContainer}>
              <Image source={{ uri: photos.pledgePhoto }} style={styles.photoPreview} />
              <TouchableOpacity style={styles.cameraButton} onPress={() => showImageOptions('pledgePhoto', '‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§ ‡§∂‡§™‡§• ‡§™‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç')}>
                <Text style={styles.cameraButtonText}>üì∑ ‡§®‡§à ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</Text>
              </TouchableOpacity>
            </View>
          ) : (
            <View style={styles.photoContainer}>
              <View style={styles.photoPlaceholder}>
                <Text style={styles.photoPlaceholderText}>‡§ï‡•ã‡§à ‡§´‡•ã‡§ü‡•ã ‡§®‡§π‡•Ä‡§Ç</Text>
              </View>
              <TouchableOpacity style={styles.cameraButton} onPress={() => showImageOptions('pledgePhoto', '‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§ ‡§∂‡§™‡§• ‡§™‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç')}>
                <Text style={styles.cameraButtonText}>üì∑ ‡§∂‡§™‡§• ‡§™‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</Text>
              </TouchableOpacity>
            </View>
          )}
        </View>
      </View>

      <View style={styles.submitContainer}>
        <TouchableOpacity
          style={[
            styles.submitButton,
            { 
              backgroundColor: isFormValid() ? '#4CAF50' : '#E8F5E8',
              opacity: loading ? 0.8 : 1
            }
          ]}
          onPress={confirmRegistration}
          disabled={loading || !isFormValid()}
        >
          <Text style={[
            styles.submitButtonText,
            { color: isFormValid() ? '#FFFFFF' : '#4CAF50' }
          ]}>
            {loading ? '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...' : '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç'}
          </Text>
        </TouchableOpacity>
      </View>

    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  header: {
    backgroundColor: '#4CAF50',
    padding: 20,
    alignItems: 'center',
    elevation: 4,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 3.84,
  },
  headerText: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#ffffff',
  },
  section: {
    backgroundColor: '#ffffff',
    margin: 10,
    padding: 15,
    borderRadius: 10,
    elevation: 2,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 1 },
    shadowOpacity: 0.22,
    shadowRadius: 2.22,
  },
  sectionTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 15,
    textAlign: 'center',
  },
  label: {
    fontSize: 16,
    fontWeight: '600',
    color: '#333333',
    marginTop: 10,
    marginBottom: 5,
  },
  input: {
    borderWidth: 1,
    borderColor: '#E0E0E0',
    padding: 12,
    marginBottom: 10,
    borderRadius: 8,
    fontSize: 16,
    backgroundColor: '#fafafa',
  },
  photoContainer: {
    alignItems: 'center',
    marginBottom: 10,
    flexDirection: 'column',
    justifyContent: 'center',
  },
  uploadBlock: {
    marginBottom: 25,
    alignItems: 'center',
    justifyContent: 'center',
  },
  photoPreview: {
    width: 220,
    height: 160,
    borderRadius: 16,
    marginBottom: 12,
    borderWidth: 3,
    borderColor: '#4CAF50',
    backgroundColor: '#e8f5e9',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 5,
  },
  photoPlaceholder: {
    width: 220,
    height: 160,
    borderRadius: 16,
    marginBottom: 12,
    borderWidth: 2,
    borderColor: '#BDBDBD',
    backgroundColor: '#f0f0f0',
    alignItems: 'center',
    justifyContent: 'center',
  },
  photoPlaceholderText: {
    color: '#BDBDBD',
    fontSize: 16,
  },
  cameraButton: {
    backgroundColor: '#4CAF50',
    borderRadius: 25,
    paddingHorizontal: 20,
    paddingVertical: 10,
    elevation: 3,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 3.84,
    marginBottom: 5,
  },
  cameraButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
    letterSpacing: 0.5,
  },
  submitContainer: {
    margin: 10,
    padding: 20,
    borderRadius: 15,
    elevation: 5,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 3 },
    shadowOpacity: 0.3,
    shadowRadius: 4.65,
  },
  submitButton: {
    paddingVertical: 14,
    paddingHorizontal: 28,
    borderRadius: 20,
    alignItems: 'center',
    justifyContent: 'center',
  },
  submitButtonText: {
    fontSize: 15,
    fontWeight: '600',
    textAlign: 'center',
    letterSpacing: 0.3,
  },
});
